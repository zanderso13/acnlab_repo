% I need to resolve the issue of depression being related to elevated OFC
% activation while reduced OFC activation is apparently related to the tri
% level measure of anhedonia. Very strange. But now I get to see how
% symptoms relate to diagnoses so yay!!

% First! Set up repos, directories, the usual

repodir = '~/Documents/repo';
datadir = '/Users/zaz3744/Documents/repo/acnlab_repo/data';
clinicaldir = '/Users/zaz3744/Documents/current_projects/ACNlab/BrainMAPD/clinical_data';
addpath(genpath(repodir))

%% Load in data files
load(fullfile(datadir,'tri_level_final.mat'));
load(fullfile(datadir,'mid_significant_contrasts.mat'));
load(fullfile(clinicaldir,'BrainMAPD_clinical_diagnoses_final.mat'))
%%
% Select cases 

trilevel dataset if we get enough power to actually consider current
depression vs anhedonia, etc
for sub = 1:length(curr_analysis_table.PID)
    if isempty(find(trilevel.ID(:) == curr_analysis_table.PID(sub))) == 0  
        curr = find(trilevel.ID(:) == curr_analysis_table.PID(sub));
        GenDis(sub,1) = trilevel.GenDis(curr);
        GenDis(sub,2) = curr_analysis_table.PID(sub);
        Fears(sub,1) = trilevel.Fears(curr);
        Fears(sub,2) = curr_analysis_table.PID(sub);
        Anhed(sub,1) = trilevel.Anhedon(curr);
        Anhed(sub,2) = curr_analysis_table.PID(sub);            
    else
        disp('Missing Trilevel for:')
        disp(curr_analysis_table.PID(sub))
        GenDis(sub,1)=NaN;
        GenDis(sub,2) = curr_analysis_table.PID(sub);
        Fears(sub,1)=NaN;
        Fears(sub,2) = curr_analysis_table.PID(sub);
        Anhed(sub,1)=NaN;
        Anhed(sub,2) = curr_analysis_table.PID(sub);
    end
end

clear sub

for sub = 1:length(curr_analysis_table.PID)
    if isempty(find(clinical_info.PID(:) == curr_analysis_table.PID)) == 0
        curr2 = find(clinical_info.PID(:) == curr_analysis_table.PID);
        Dep(sub,1) = clinical_info.dep_life_any(curr2);
        Dep(sub,2) = curr_analysis_table.PID;
        Anx(sub,1) = clinical_info.anx_life_any(curr2);
        Anx(sub,2) = trilevel.ID(sub);
        Com(sub,1) = clinical_info.comorbid_life_dep_anx(curr2);
        Com(sub,2) = trilevel.ID(sub);
        curr_dep(sub,1) = clinical_info.dep_curr_any(curr2);
        curr_dep(sub,2) = trilevel.ID(sub);
        curr_anx(sub,1) = clinical_info.anx_curr_any(curr2);
        curr_anx(sub,2) = trilevel.ID(sub);
    else
        disp('Missing SCID for:')
        disp(trilevel.ID(sub))
        Dep(sub,1) = NaN;
        Dep(sub,2) = curr_analysis_table.PID(sub);
        Anx(sub,1) = NaN;
        Anx(sub,2) = curr_analysis_table.PID(sub);
        curr_dep(sub,1) = NaN;
        curr_dep(sub,2) = curr_analysis_table.PID(sub);
        curr_anx(sub,1) = NaN;
        curr_anx(sub,2) = curr_analysis_table.PID(sub);
    end
end



%% Create anova input

lifetime_regressors = ones(length(Dep),1);
lifetime_regressors(Dep(:,1)==1) = 2;
lifetime_regressors(Anx(:,1)==1) = 3;
lifetime_regressors(Com(:,1)==1) = 4;

lifetime_diagnosis = cell(length(lifetime_regressors),1);
lifetime_diagnosis(lifetime_regressors(:,1)==1) = {'Healthy'};
lifetime_diagnosis(lifetime_regressors(:,1)==2) = {'Depression'};
lifetime_diagnosis(lifetime_regressors(:,1)==3) = {'Anxiety'};
lifetime_diagnosis(lifetime_regressors(:,1)==4) = {'Comorbidity'};

curr_regressors = ones(length(Dep),1);
curr_regressors(curr_dep(:,1)==1) = 2;
curr_regressors(curr_anx(:,1)==1) = 3;

curr_diagnosis = cell(length(curr_regressors),1);
curr_diagnosis(curr_regressors(:,1)==1) = {'Healthy'};
curr_diagnosis(curr_regressors(:,1)==2) = {'Current Depression'};
curr_diagnosis(curr_regressors(:,1)==3) = {'Current Anxiety'};
%% Stats and graphs baby
% Anhedonia
[p,tbl,stats] = anova1(Anhed(:,1),curr_diagnosis)

figure; [c,m,h]=multcompare(stats)

%% General Distress
[p,tbl,stats] = anova1(GenDis(:,1),curr_diagnosis)

figure; [c,m,h]=multcompare(stats)

%% Fears

[p,tbl,stats] = anova1(Fears(:,1),curr_diagnosis)

figure; [c,m,h]=multcompare(stats)



